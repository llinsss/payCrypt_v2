name: Issue Auto Labeler

on:
  issues:
    types: [opened, edited]

permissions:
  issues: write

jobs:
  auto-label:
    name: Auto Label Issues
    runs-on: ubuntu-latest
    
    steps:
      - name: Label based on content
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const title = issue.title.toLowerCase();
            const body = (issue.body || '').toLowerCase();
            const labels = [];
            
            // Priority labels
            if (title.includes('critical') || body.includes('critical')) {
              labels.push('critical');
            } else if (title.includes('urgent') || body.includes('urgent')) {
              labels.push('high-priority');
            }
            
            // Type labels
            if (title.includes('bug') || title.includes('fix')) {
              labels.push('bug');
            } else if (title.includes('feature') || title.includes('feat')) {
              labels.push('enhancement');
            } else if (title.includes('security')) {
              labels.push('security');
            } else if (title.includes('performance') || title.includes('perf')) {
              labels.push('performance');
            } else if (title.includes('docs') || title.includes('documentation')) {
              labels.push('documentation');
            }
            
            // Difficulty labels
            if (body.includes('difficulty: easy') || body.includes('easy')) {
              labels.push('good-first-issue');
            }
            
            // Backend label
            if (title.includes('backend') || body.includes('backend')) {
              labels.push('backend');
            }
            
            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: labels
              });
            }
            
            // Welcome message for first-time contributors
            const { data: issueComments } = await github.rest.issues.listComments({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number
            });
            
            if (issueComments.length === 0) {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                body: `ðŸ‘‹ Thanks for opening this issue!\n\nA maintainer will review it soon. If you'd like to work on this:\n1. Comment "I'd like to work on this"\n2. Wait for assignment\n3. Fork the repo and create a PR\n\nSee [BACKEND_ISSUES.md](../BACKEND_ISSUES.md) for guidelines.`
              });
            }
